language: cpp

addons: &gcc7
  apt:
    packages:
      - g++-7
      - cppcheck
    sources:
      - ubuntu-toolchain-r-test

addons: &clang6
  apt:
    packages:
      - clang-6.0
    sources:
      - ubuntu-toolchain-r-test
      - llvm-toolchain-bionic-6.0

matrix:
  include:
    - env: GCC_VERSION=7
      os: linux
      dist: bionic
      addons: &gcc7

    - env: CLANG_VERSION=6
      os: linux
      dist: bionic
      addons: &clang6

before_install:
  - sudo apt-get -y install libssl-dev libsodium-dev

before_script:
  - echo ${GCC_VERSION}
  - echo ${CLANG_VERSION}
  - if [ -n "$GCC_VERSION" ]; then export CXX="g++-${GCC_VERSION}" CC="gcc-${GCC_VERSION}"; fi
  - if [ -n "$CLANG_VERSION" ]; then export CXX="clang++-${CLANG_VERSION}" CC="clang-${CLANG_VERSION}"; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then export CXX="clang++" CC="clang"; fi
  - $CXX --version
  - cmake --version

script:
    - mkdir -p build && cd build
    - cmake ..
    - make -j2
    - make test CTEST_OUTPUT_ON_FAILURE=TRUE
    - cppcheck src/
